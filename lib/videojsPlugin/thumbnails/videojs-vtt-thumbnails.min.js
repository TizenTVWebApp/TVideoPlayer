/**
 * videojs-vtt-thumbnails
 * @version 0.0.8
 * @copyright 2018 Chris Boustead <chris@forgemotion.com>
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):t.videojsVttThumbnails=e(t.videojs)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;!function(){function t(t){this.value=t}function e(e){function r(i,o){try{var n=e[i](o),a=n.value;a instanceof t?Promise.resolve(a.value).then(function(t){r("next",t)},function(t){r("throw",t)}):s(n.done?"return":"normal",n.value)}catch(t){s("throw",t)}}function s(t,e){switch(t){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}(i=i.next)?r(i.key,i.arg):o=null}var i,o;this._invoke=function(t,e){return new Promise(function(s,n){var a={key:t,arg:e,resolve:s,reject:n,next:null};o?o=o.next=a:(i=o=a,r(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}();var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r={},s=t.registerPlugin||t.plugin,i=function(e){var s=this;this.ready(function(){!function(t,e){t.addClass("vjs-vtt-thumbnails"),t.vttThumbnails=new o(t,e)}(s,t.mergeOptions(r,e))})},o=function(){function t(r,s){return e(this,t),this.player=r,this.options=s,this.initializeThumbnails(),this.registeredEvents={},this}return t.prototype.src=function(t){this.resetPlugin(),this.options.src=t,this.initializeThumbnails()},t.prototype.detach=function(){this.resetPlugin()},t.prototype.resetPlugin=function(){this.thumbnailHolder&&this.thumbnailHolder.parentNode.removeChild(this.thumbnailHolder),this.progressBar&&this.progressBar.removeEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar&&this.progressBar.removeEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave),this.progressBar&&this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove),delete this.registeredEvents.progressBarMouseEnter,delete this.registeredEvents.progressBarMouseLeave,delete this.registeredEvents.progressBarMouseMove,delete this.progressBar,delete this.vttData,delete this.thumbnailHolder,delete this.lastStyle},t.prototype.initializeThumbnails=function(){var t=this;if(this.options.src){var e=this.getBaseUrl(),r=this.getFullyQualifiedUrl(this.options.src,e);this.getVttFile(r).then(function(e){t.vttData=t.processVtt(e),t.setupThumbnailElement()})}},t.prototype.getBaseUrl=function(){return[window.location.protocol,"//",window.location.hostname,window.location.port?":"+window.location.port:"",window.location.pathname].join("").split(/([^\/]*)$/gi).shift()},t.prototype.getVttFile=function(t){var e=this;return new Promise(function(r,s){var i=new XMLHttpRequest;i.data={resolve:r},i.addEventListener("load",e.vttFileLoaded),i.open("GET",t),i.send()})},t.prototype.vttFileLoaded=function(){this.data.resolve(this.responseText)},t.prototype.setupThumbnailElement=function(t){var e=this,r=this.player.$(".vjs-mouse-display");this.progressBar=this.player.$(".vjs-progress-control");var s=document.createElement("div");s.setAttribute("class","vjs-vtt-thumbnail-display"),this.progressBar.appendChild(s),this.thumbnailHolder=s,r.classList.add("vjs-hidden"),this.registeredEvents.progressBarMouseEnter=function(){return e.onBarMouseenter()},this.registeredEvents.progressBarMouseLeave=function(){return e.onBarMouseleave()},this.progressBar.addEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.addEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave)},t.prototype.onBarMouseenter=function(){var t=this;this.mouseMoveCallback=function(e){t.onBarMousemove(e)},this.registeredEvents.progressBarMouseMove=this.mouseMoveCallback,this.progressBar.addEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.showThumbnailHolder()},t.prototype.onBarMouseleave=function(){this.registeredEvents.progressBarMouseMove&&this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.hideThumbnailHolder()},t.prototype.onBarMousemove=function(t){this.updateThumbnailStyle(t.clientX-this.progressBar.offsetLeft,this.progressBar.offsetWidth)},t.prototype.getStyleForTime=function(t){for(var e=0;e<this.vttData.length;++e){var r=this.vttData[e];if(t>=r.start&&t<r.end)return r.css}},t.prototype.showThumbnailHolder=function(){this.thumbnailHolder.style.opacity="1"},t.prototype.hideThumbnailHolder=function(){this.thumbnailHolder.style.opacity="0"},t.prototype.updateThumbnailStyle=function(t,e){var r=(1-(e-t)/e)*this.player.duration(),s=this.getStyleForTime(r);if(!s)return this.hideThumbnailHolder();var i=(1-(e-t)/e)*e;if(this.thumbnailHolder.style.transform="translateX("+i+"px)",this.thumbnailHolder.style.marginLeft="-"+parseInt(s.width)/2+"px",!this.lastStyle||this.lastStyle!==s){this.lastStyle=s;for(var o in s)s.hasOwnProperty(o)&&(this.thumbnailHolder.style[o]=s[o])}},t.prototype.processVtt=function(t){var e=this,r=[];return t.split(/[\r\n][\r\n]/i).forEach(function(t){if(t.match(/([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?( ?--> ?)([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?[\r\n]{1}.*/gi)){var s=t.split(/[\r\n]/i),i=s[0].split(/ ?--> ?/i),o=i[0],n=i[1],a=s[1],u=e.getVttCss(a);r.push({start:e.getSecondsFromTimestamp(o),end:e.getSecondsFromTimestamp(n),css:u})}}),r},t.prototype.getFullyQualifiedUrl=function(t,e){return t.indexOf("//")>=0?t:0===e.indexOf("//")?[e.replace(/\/$/gi,""),this.trim(t,"/")].join("/"):e.indexOf("//")>0?[this.trim(e,"/"),this.trim(t,"/")].join("/"):t},t.prototype.getPropsFromDef=function(t){var e=t.split(/#xywh=/i),r=e[0],s=e[1].match(/[0-9]+/gi);return{x:s[0],y:s[1],w:s[2],h:s[3],image:r}},t.prototype.getVttCss=function(t){var e={},r=void 0;if(r=this.options.src.indexOf("//")>=0?this.options.src.split(/([^\/]*)$/gi).shift():this.getBaseUrl()+this.options.src.split(/([^\/]*)$/gi).shift(),!(t=this.getFullyQualifiedUrl(t,r)).match(/#xywh=/i))return e.background='url("'+t+'")',e;var s=this.getPropsFromDef(t);return e.background='url("'+s.image+'") no-repeat -'+s.x+"px -"+s.y+"px",e.width=s.w+"px",e.height=s.h+"px",e},t.prototype.doconstructTimestamp=function(t){var e=t.split("."),r=e[0].split(":");return{milliseconds:parseInt(e[1])||0,seconds:parseInt(r.pop())||0,minutes:parseInt(r.pop())||0,hours:parseInt(r.pop())||0}},t.prototype.getSecondsFromTimestamp=function(t){var e=this.doconstructTimestamp(t);return parseInt(3600*e.hours+60*e.minutes+e.seconds+e.milliseconds/1e3)},t.prototype.trim=function(t,e){var r=[" ","\n","\r","\t","\f","\v"," "," "," "," "," "," "," "," "," "," "," "," ","​","\u2028","\u2029","　"].join(""),s=0,i=0;for(t+="",e&&(r=(e+"").replace(/([[\]().?/*{}+$^:])/g,"$1")),s=t.length,i=0;i<s;i++)if(-1===r.indexOf(t.charAt(i))){t=t.substring(i);break}for(i=(s=t.length)-1;i>=0;i--)if(-1===r.indexOf(t.charAt(i))){t=t.substring(0,i+1);break}return-1===r.indexOf(t.charAt(0))?t:""},t}();return s("vttThumbnails",i),i.VERSION="0.0.8",i});